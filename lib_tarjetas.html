<script>
function crearTarjetaContactos() {
    limpiar();

    google.script.run
        .withSuccessHandler(crearTarjetasContactosOk)
        .withFailureHandler(crearTarjetasContactosError)
        .obtenerContactos();
}

function crearTarjetasContactosError() {
    // Mostrar Notificacion de Error
    crearNotificacionERROR('No se han podido Crear las Tarjetas de los contactos','Tarjetas de contactos');

    // Eliminar el Loader
    eliminarLoader();
}


function crearTarjetasContactosOk(obj) {
    let tarjetas = document.createElement('div');
    tarjetas.id = 'tarjetasContactos';
    tarjetas.classList.add('container');

    for (let i = 1; i < obj.length; i++) {
        let tarjeta =
        {
            nombre: obj[i][0],
            apellido: obj[i][1],
            correo: obj[i][2],
            telefono: obj[i][3],
            imagen: obj[i][4],
            indice: i+1
        };

        // Agregamos Tarjeta al Total de Tarjetas
        tarjetas.appendChild(crearTarjeta(tarjeta));
    }

    // Agregar Tarjetas
    document.getElementById('divContactos').appendChild(tarjetas);

    // Eliminar el Loader
    eliminarLoader();
}


function crearTarjeta (tarjeta) {
    // divTarjeta
    let divTarjeta = document.createElement('div');
    divTarjeta.id = 'tarjeta'+tarjeta.indice;
    divTarjeta.classList.add('row', 'border', 'border-3', 'border-dark', 'rounded', 'bg-light', 'm-3', 'p-3');


    // Creamos datos y botones de la Tarjeta
    let datosTarjeta = crearDatosTarjeta(tarjeta);
    let divBotones = crearBotonesTarjeta(tarjeta);
    datosTarjeta.appendChild(divBotones);

    // Creamos Imagen de la Tarjeta
    let imagenTarjeta = crearImagenTarjeta(tarjeta);

    // Agregamos todo a divTarjeta y lo devolvemos
    divTarjeta.appendChild(datosTarjeta);
    divTarjeta.appendChild(imagenTarjeta);

    return divTarjeta;
}

function crearDatosTarjeta(tarjeta) {
    let datosTarjeta = document.createElement('div');
    datosTarjeta.classList.add('col-6', 'd-flex', 'flex-column', 'align-items-start');

    // Nombre y Apellido
    let nombre = document.createElement('h3');
    nombre.textContent = tarjeta.apellido + ', ' + tarjeta.nombre;

    // Correo
    let correo = document.createElement('div');
    correo.classList.add('d-flex');
    let iconoCorreo = document.createElement('i');
    iconoCorreo.classList.add('bi', 'bi-envelope-fill', 'me-2');
    let tituloCorreo = document.createElement('h5');
    tituloCorreo.textContent = tarjeta.correo;
    correo.appendChild(iconoCorreo);
    correo.appendChild(tituloCorreo);

    // Telefono
    let telefono = document.createElement('div');
    telefono.classList.add('d-flex');
    let iconoTelefono = document.createElement('i');
    iconoTelefono.classList.add('bi', 'bi-telephone-fill', 'me-2');
    let tituloTelefono = document.createElement('h5');
    tituloTelefono.textContent = tarjeta.telefono;
    telefono.appendChild(iconoTelefono);
    telefono.appendChild(tituloTelefono);

    // Agregamos datos
    datosTarjeta.appendChild(nombre);
    datosTarjeta.appendChild(correo);
    datosTarjeta.appendChild(telefono);

    return datosTarjeta;
}


function crearBotonesTarjeta(tarjeta) {
    let divBotones = document.createElement('div');
    divBotones.classList.add('d-flex', 'justify-content-start', 'mt-auto');

    divBotones.appendChild(crearBotonInfoTarjeta(tarjeta));
    divBotones.appendChild(crearBotonBorrarTarjeta(tarjeta));
    divBotones.appendChild(crearBotonModificarTarjeta(tarjeta));

    return divBotones;
}

function crearBotonInfoTarjeta(tarjeta) {
    // Boton Info
    let botonInfo = document.createElement('button');
    botonInfo.id = 'botonInfo'+tarjeta.indice;
    botonInfo.classList.add('btn', 'btn-success', 'm-1');
    botonInfo.onclick = () => mostrarInformacionAdicionalContacto(tarjeta);

    // Icono
    let iconoInfo = document.createElement('i');
    iconoInfo.classList.add('bi', 'bi-plus-square');
    botonInfo.appendChild(iconoInfo);

    return botonInfo;
}

function crearBotonBorrarTarjeta(tarjeta) {
    // Boton Borrar
    let botonBorrar = document.createElement('button');
    botonBorrar.id = 'botonBorrar'+tarjeta.indice;
    botonBorrar.classList.add('btn', 'btn-danger', 'm-1');
    botonBorrar.onclick = () => borrarContacto(tarjeta.indice);

    // Icono
    let iconoBorrar = document.createElement('i');
    iconoBorrar.classList.add('bi', 'bi-trash');
    botonBorrar.appendChild(iconoBorrar);

    return botonBorrar;
}

function crearBotonModificarTarjeta(tarjeta) {
    // Boton Modificar
    let botonModificar = document.createElement('button');
    botonModificar.id = 'botonModificar'+tarjeta.indice;
    botonModificar.classList.add('btn', 'btn-warning', 'm-1');
    botonModificar.onclick = () => abrirModalModificarContacto(tarjeta.indice, tarjeta);

    // Icono
    let iconoModificar = document.createElement('i');
    iconoModificar.classList.add('bi', 'bi-pencil-square');
    botonModificar.appendChild(iconoModificar);

    return botonModificar;
}



function crearImagenTarjeta(tarjeta) {
    let imagenTarjeta = document.createElement('div');
    imagenTarjeta.classList.add('col-6', 'rounded', 'd-flex', 'justify-content-end');
    let cajaImagenTarjeta = document.createElement('div');
    cajaImagenTarjeta.classList.add('box', 'border', 'border-3', 'border-dark','rounded');
    let imagen = document.createElement('img');
    imagen.classList.add('img-fluid', 'rounded', 'img-contacto');
    imagen.src = tarjeta.imagen;

    // Agregamos imagen a la caja y tarjeta
    cajaImagenTarjeta.appendChild(imagen);
    imagenTarjeta.appendChild(cajaImagenTarjeta);

    return imagenTarjeta;
}


function mostrarInformacionAdicionalContacto(tarjeta) {

}

</script>